<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥ Ph·ªèng Di Chuy·ªÉn Tuy·∫øn ƒê∆∞·ªùng</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            margin: 0;
            font-size: 2.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header .subtitle {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .controls {
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: bold;
            color: #495057;
            font-size: 14px;
        }

        select,
        input,
        button {
            padding: 10px 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        select:focus,
        input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        button {
            background: #007bff;
            color: white;
            cursor: pointer;
            border: none;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button.active {
            background: #28a745;
        }

        button.reset {
            background: #dc3545;
        }

        button.reset:hover {
            background: #c82333;
        }

        .main-content {
            display: flex;
            height: 80vh;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            background: #f8f9fa;
        }

        #routeCanvas {
            width: 100%;
            height: 100%;
            border: none;
            cursor: grab;
        }

        #routeCanvas:active {
            cursor: grabbing;
        }

        .sidebar {
            width: 400px;
            background: #2c3e50;
            color: white;
            overflow-y: auto;
        }

        .status-panel {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #3c5068;
        }

        .status-panel h3 {
            margin: 0 0 15px 0;
            color: #ecf0f1;
            font-size: 1.3em;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #3c5068;
        }

        .status-label {
            color: #bdc3c7;
        }

        .status-value {
            color: #3498db;
            font-weight: bold;
        }

        .vehicles-panel {
            padding: 20px;
        }

        .vehicles-panel h3 {
            margin: 0 0 15px 0;
            color: #ecf0f1;
            font-size: 1.3em;
        }

        .vehicle-item {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .vehicle-item:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: translateX(5px);
        }

        .vehicle-item.active {
            border-left-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .vehicle-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }

        .vehicle-id {
            font-weight: bold;
            color: #ecf0f1;
            font-size: 1.1em;
        }

        .vehicle-status {
            font-size: 0.9em;
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: auto;
        }

        .vehicle-status.moving {
            background: #27ae60;
            color: white;
        }

        .vehicle-status.stopped {
            background: #f39c12;
            color: white;
        }

        .vehicle-info {
            font-size: 0.9em;
            color: #bdc3c7;
            line-height: 1.4;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #34495e;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .time-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .legend h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .pulsing {
            animation: pulse 2s infinite;
        }

        @keyframes vehicleMove {
            0% {
                transform: scale(1) rotate(0deg);
            }

            50% {
                transform: scale(1.1) rotate(5deg);
            }

            100% {
                transform: scale(1) rotate(0deg);
            }
        }

        .moving-vehicle {
            animation: vehicleMove 0.5s infinite;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üöõ M√¥ Ph·ªèng Di Chuy·ªÉn Logistics</h1>
            <p class="subtitle">Tr·ª±c quan h√≥a th·ªùi gian th·ª±c - D·ªØ li·ªáu t·ª´ lr209.txt</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="routeSelect">Ch·ªçn tuy·∫øn:</label>
                <select id="routeSelect">
                    <option value="all">T·∫•t c·∫£ tuy·∫øn</option>
                </select>
            </div>

            <div class="control-group">
                <label for="speedSlider">T·ªëc ƒë·ªô (x):</label>
                <input type="range" id="speedSlider" min="0.1" max="5" value="1" step="0.1">
                <span id="speedValue">1.0x</span>
            </div>

            <div class="control-group">
                <button id="playPauseBtn" onclick="toggleAnimation()">‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu</button>
            </div>

            <div class="control-group">
                <button onclick="resetAnimation()" class="reset">üîÑ Reset</button>
            </div>

            <div class="control-group">
                <button onclick="toggleTrails()">üëÅÔ∏è Hi·ªán v·∫øt</button>
            </div>
        </div>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="routeCanvas"></canvas>
                <div class="time-display" id="timeDisplay">00:00:00</div>
                <div class="legend">
                    <h4>Ch√∫ th√≠ch</h4>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #e74c3c;"></div>
                        <span>Depot (Kho)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #3498db;"></div>
                        <span>Kh√°ch h√†ng</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #27ae60;"></div>
                        <span>Xe ƒëang di chuy·ªÉn</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #f39c12;"></div>
                        <span>Xe ƒëang d·ª´ng</span>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="status-panel">
                    <h3>üìä Tr·∫°ng th√°i h·ªá th·ªëng</h3>
                    <div class="status-item">
                        <span class="status-label">Th·ªùi gian m√¥ ph·ªèng:</span>
                        <span class="status-value" id="simTime">00:00:00</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Xe ƒëang di chuy·ªÉn:</span>
                        <span class="status-value" id="activeVehicles">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">T·ªïng kho·∫£ng c√°ch:</span>
                        <span class="status-value" id="totalDistance">0 km</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Kh√°ch h√†ng ƒë√£ ph·ª•c v·ª•:</span>
                        <span class="status-value" id="servedCustomers">0/102</span>
                    </div>
                </div>

                <div class="vehicles-panel">
                    <h3>üöõ Danh s√°ch xe</h3>
                    <div id="vehiclesList">
                        <!-- Vehicle items will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu tuy·∫øn ƒë∆∞·ªùng
        const routesData = [
            [0, 20, 29, 31, 60, 0],
            [0, 21, 30, 39, 88, 0],
            [0, 22, 49, 0],
            [0, 67, 74, 102, 0],
            [0, 65, 64, 59, 0],
            [0, 23, 52, 37, 0],
            [0, 63, 61, 51, 0],
            [0, 24, 34, 104, 0],
            [0, 5, 1, 96, 101, 0],
            [0, 25, 11, 14, 0],
            [0, 26, 9, 100, 0],
            [0, 69, 72, 0],
            [0, 75, 2, 95, 93, 77, 0],
            [0, 7, 6, 89, 0],
            [0, 3, 98, 94, 92, 84, 0],
            [0, 43, 42, 41, 40, 44, 46, 0],
            [0, 66, 48, 85, 0],
            [0, 10, 12, 97, 79, 0],
            [0, 27, 36, 83, 0],
            [0, 28, 50, 45, 0],
            [0, 103, 106, 82, 0],
            [0, 47, 0],
            [0, 62, 68, 80, 0],
            [0, 4, 91, 0],
            [0, 8, 99, 0]
        ];

        // Canvas v√† context
        const canvas = document.getElementById('routeCanvas');
        const ctx = canvas.getContext('2d');

        // Bi·∫øn global
        let coordinates = {};
        let vehicles = [];
        let isAnimating = false;
        let selectedRoute = 'all';
        let animationSpeed = 1.0;
        let showTrails = false;
        let trails = [];
        let startTime = Date.now();
        let simulationTime = 0;
        let servedCustomers = new Set();

        // M√†u s·∫Øc
        const colors = [
            '#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6',
            '#1abc9c', '#34495e', '#e67e22', '#95a5a6', '#f1c40f',
            '#8e44ad', '#2c3e50', '#d35400', '#7f8c8d', '#c0392b',
            '#2980b9', '#27ae60', '#f39c12', '#8e44ad', '#16a085',
            '#2c3e50'
        ];

        // Kh·ªüi t·∫°o
        function init() {
            resizeCanvas();
            generateCoordinates();
            initializeVehicles();
            populateRouteSelect();
            populateVehiclesList();
            setupEventListeners();
            render();
        }

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
        }

        function generateCoordinates() {
            const maxNode = Math.max(...routesData.flat());
            const padding = 80;
            const centerX = 600;
            const centerY = 400;

            // Depot ·ªü trung t√¢m
            coordinates[0] = { x: centerX, y: centerY };

            // T·∫°o t·ªça ƒë·ªô cho c√°c ƒëi·ªÉm kh√°c theo h√¨nh tr√≤n
            for (let i = 1; i <= maxNode; i++) {
                const angle = (i / maxNode) * 2 * Math.PI;
                const radiusVariation = 0.7 + Math.random() * 0.6; // 0.7 - 1.3
                const radius = 250 * radiusVariation;

                coordinates[i] = {
                    x: centerX + Math.cos(angle) * radius,
                    y: centerY + Math.sin(angle) * radius
                };
            }
        }

        function initializeVehicles() {
            vehicles = [];
            routesData.forEach((route, index) => {
                if (route.length > 2) {
                    vehicles.push({
                        id: index + 1,
                        route: route,
                        currentSegment: 0,
                        progress: 0,
                        position: { ...coordinates[route[0]] },
                        isMoving: false,
                        color: colors[index % colors.length],
                        totalDistance: 0,
                        customersServed: route.filter(node => node !== 0).length,
                        stopTime: 0,
                        nextStopDuration: getRandomStopDuration()
                    });
                }
            });
        }

        function getRandomStopDuration() {
            return 2000 + Math.random() * 3000; // 2-5 seconds
        }

        function populateRouteSelect() {
            const select = document.getElementById('routeSelect');
            routesData.forEach((route, index) => {
                if (route.length > 2) {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `Tuy·∫øn ${index + 1} (${route.length - 2} kh√°ch h√†ng)`;
                    select.appendChild(option);
                }
            });

            select.addEventListener('change', (e) => {
                selectedRoute = e.target.value;
                render();
            });
        }

        function populateVehiclesList() {
            const container = document.getElementById('vehiclesList');
            container.innerHTML = '';

            vehicles.forEach(vehicle => {
                const vehicleDiv = document.createElement('div');
                vehicleDiv.className = 'vehicle-item';
                vehicleDiv.id = `vehicle-${vehicle.id}`;

                vehicleDiv.innerHTML = `
                    <div class="vehicle-header">
                        <span class="vehicle-id">üöõ Xe ${vehicle.id}</span>
                        <span class="vehicle-status stopped">D·ª´ng</span>
                    </div>
                    <div class="vehicle-info">
                        <div>Tuy·∫øn: ${vehicle.route.join(' ‚Üí ')}</div>
                        <div>V·ªã tr√≠ hi·ªán t·∫°i: Depot</div>
                        <div>Ti·∫øn ƒë·ªô: 0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                `;

                container.appendChild(vehicleDiv);
            });
        }

        function setupEventListeners() {
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', (e) => {
                animationSpeed = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = animationSpeed.toFixed(1) + 'x';
            });

            window.addEventListener('resize', () => {
                resizeCanvas();
                render();
            });
        }

        function toggleAnimation() {
            isAnimating = !isAnimating;
            const btn = document.getElementById('playPauseBtn');

            if (isAnimating) {
                btn.textContent = '‚è∏Ô∏è T·∫°m d·ª´ng';
                btn.classList.add('active');
                startTime = Date.now() - simulationTime;
                animate();
            } else {
                btn.textContent = '‚ñ∂Ô∏è Ti·∫øp t·ª•c';
                btn.classList.remove('active');
            }
        }

        function resetAnimation() {
            isAnimating = false;
            simulationTime = 0;
            startTime = Date.now();
            servedCustomers.clear();
            trails = [];

            // Reset vehicles
            vehicles.forEach(vehicle => {
                vehicle.currentSegment = 0;
                vehicle.progress = 0;
                vehicle.position = { ...coordinates[vehicle.route[0]] };
                vehicle.isMoving = false;
                vehicle.totalDistance = 0;
                vehicle.stopTime = 0;
                vehicle.nextStopDuration = getRandomStopDuration();
            });

            const btn = document.getElementById('playPauseBtn');
            btn.textContent = '‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu';
            btn.classList.remove('active');

            updateUI();
            render();
        }

        function toggleTrails() {
            showTrails = !showTrails;
            if (!showTrails) {
                trails = [];
            }
            render();
        }

        function animate() {
            if (!isAnimating) return;

            simulationTime = Date.now() - startTime;
            const deltaTime = 16; // ~60fps

            vehicles.forEach(vehicle => {
                updateVehicle(vehicle, deltaTime * animationSpeed);
            });

            updateUI();
            render();
            requestAnimationFrame(animate);
        }

        function updateVehicle(vehicle, deltaTime) {
            if (vehicle.currentSegment >= vehicle.route.length - 1) {
                vehicle.isMoving = false;
                return;
            }

            const currentNode = vehicle.route[vehicle.currentSegment];
            const nextNode = vehicle.route[vehicle.currentSegment + 1];

            if (!vehicle.isMoving) {
                // Vehicle is stopped at a node
                vehicle.stopTime += deltaTime;
                if (vehicle.stopTime >= vehicle.nextStopDuration) {
                    vehicle.isMoving = true;
                    vehicle.stopTime = 0;
                    vehicle.nextStopDuration = getRandomStopDuration();

                    // Mark customer as served
                    if (currentNode !== 0) {
                        servedCustomers.add(currentNode);
                    }
                }
                return;
            }

            // Vehicle is moving
            const speed = 0.0008 * animationSpeed; // Adjusted speed
            vehicle.progress += speed;

            if (vehicle.progress >= 1) {
                // Reached next node
                vehicle.progress = 0;
                vehicle.currentSegment++;
                vehicle.isMoving = false;

                if (vehicle.currentSegment < vehicle.route.length) {
                    vehicle.position = { ...coordinates[vehicle.route[vehicle.currentSegment]] };
                }
            } else {
                // Interpolate position
                const from = coordinates[currentNode];
                const to = coordinates[nextNode];

                if (from && to) {
                    vehicle.position.x = from.x + (to.x - from.x) * vehicle.progress;
                    vehicle.position.y = from.y + (to.y - from.y) * vehicle.progress;

                    // Add to trail
                    if (showTrails) {
                        trails.push({
                            x: vehicle.position.x,
                            y: vehicle.position.y,
                            color: vehicle.color,
                            time: Date.now()
                        });
                    }

                    // Update total distance
                    const distance = Math.sqrt(
                        Math.pow(to.x - from.x, 2) + Math.pow(to.y - from.y, 2)
                    );
                    vehicle.totalDistance += distance * speed;
                }
            }
        }

        function updateUI() {
            // Update time display
            const hours = Math.floor(simulationTime / 3600000);
            const minutes = Math.floor((simulationTime % 3600000) / 60000);
            const seconds = Math.floor((simulationTime % 60000) / 1000);

            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timeDisplay').textContent = timeString;
            document.getElementById('simTime').textContent = timeString;

            // Update status
            const activeVehicles = vehicles.filter(v => v.isMoving).length;
            document.getElementById('activeVehicles').textContent = activeVehicles;

            const totalDistance = vehicles.reduce((sum, v) => sum + v.totalDistance, 0);
            document.getElementById('totalDistance').textContent = (totalDistance / 100).toFixed(1) + ' km';

            document.getElementById('servedCustomers').textContent = `${servedCustomers.size}/102`;

            // Update vehicle list
            vehicles.forEach(vehicle => {
                const vehicleElement = document.getElementById(`vehicle-${vehicle.id}`);
                if (vehicleElement) {
                    const statusElement = vehicleElement.querySelector('.vehicle-status');
                    const infoElement = vehicleElement.querySelector('.vehicle-info');
                    const progressElement = vehicleElement.querySelector('.progress-fill');

                    if (vehicle.isMoving) {
                        statusElement.textContent = 'Di chuy·ªÉn';
                        statusElement.className = 'vehicle-status moving';
                        vehicleElement.classList.add('active');
                    } else {
                        statusElement.textContent = 'D·ª´ng';
                        statusElement.className = 'vehicle-status stopped';
                        vehicleElement.classList.remove('active');
                    }

                    const currentNodeName = vehicle.currentSegment < vehicle.route.length ?
                        (vehicle.route[vehicle.currentSegment] === 0 ? 'Depot' : `KH ${vehicle.route[vehicle.currentSegment]}`) : 'Ho√†n th√†nh';

                    const overallProgress = (vehicle.currentSegment + vehicle.progress) / (vehicle.route.length - 1) * 100;

                    infoElement.innerHTML = `
                        <div>Tuy·∫øn: ${vehicle.route.join(' ‚Üí ')}</div>
                        <div>V·ªã tr√≠: ${currentNodeName}</div>
                        <div>Ti·∫øn ƒë·ªô: ${overallProgress.toFixed(1)}%</div>
                    `;

                    progressElement.style.width = overallProgress + '%';
                }
            });
        }

        function render() {
            if (!canvas.width || !canvas.height) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Scale to fit canvas
            const scale = Math.min(canvas.width / 1200, canvas.height / 800);
            const offsetX = (canvas.width - 1200 * scale) / 2;
            const offsetY = (canvas.height - 800 * scale) / 2;

            ctx.save();
            ctx.translate(offsetX, offsetY);
            ctx.scale(scale, scale);

            // Draw background grid
            drawGrid();

            // Draw trails if enabled
            if (showTrails) {
                drawTrails();
            }

            // Draw routes
            if (selectedRoute === 'all') {
                vehicles.forEach(vehicle => {
                    drawRoute(vehicle.route, vehicle.color, 0.3);
                });
            } else {
                const selectedVehicle = vehicles[parseInt(selectedRoute)];
                if (selectedVehicle) {
                    drawRoute(selectedVehicle.route, selectedVehicle.color, 0.7);
                }
            }

            // Draw nodes
            drawNodes();

            // Draw vehicles
            if (selectedRoute === 'all') {
                vehicles.forEach(vehicle => {
                    drawVehicle(vehicle);
                });
            } else {
                const selectedVehicle = vehicles[parseInt(selectedRoute)];
                if (selectedVehicle) {
                    drawVehicle(selectedVehicle);
                }
            }

            ctx.restore();
        }

        function drawGrid() {
            ctx.strokeStyle = 'rgba(0,0,0,0.05)';
            ctx.lineWidth = 1;

            for (let x = 0; x <= 1200; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, 800);
                ctx.stroke();
            }

            for (let y = 0; y <= 800; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(1200, y);
                ctx.stroke();
            }
        }

        function drawTrails() {
            const currentTime = Date.now();
            // Remove old trails (older than 5 seconds)
            trails = trails.filter(trail => currentTime - trail.time < 5000);

            trails.forEach((trail, index) => {
                const age = currentTime - trail.time;
                const alpha = Math.max(0, 1 - age / 5000);

                ctx.fillStyle = trail.color + Math.floor(alpha * 255).toString(16).padStart(2, '0');
                ctx.beginPath();
                ctx.arc(trail.x, trail.y, 2, 0, 2 * Math.PI);
                ctx.fill();
            });
        }

        function drawRoute(route, color, alpha = 0.5) {
            if (route.length < 2) return;

            ctx.strokeStyle = color + Math.floor(alpha * 255).toString(16).padStart(2, '0');
            ctx.lineWidth = 3;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();

            for (let i = 0; i < route.length - 1; i++) {
                const from = coordinates[route[i]];
                const to = coordinates[route[i + 1]];

                if (from && to) {
                    if (i === 0) {
                        ctx.moveTo(from.x, from.y);
                    }
                    ctx.lineTo(to.x, to.y);
                }
            }

            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawNodes() {
            // Draw depot
            const depot = coordinates[0];
            if (depot) {
                ctx.fillStyle = '#e74c3c';
                ctx.strokeStyle = '#c0392b';
                ctx.lineWidth = 3;

                ctx.beginPath();
                ctx.fillRect(depot.x - 12, depot.y - 12, 24, 24);
                ctx.strokeRect(depot.x - 12, depot.y - 12, 24, 24);

                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üè¢', depot.x, depot.y + 5);
            }

            // Draw customer nodes
            Object.keys(coordinates).forEach(nodeId => {
                const nodeNum = parseInt(nodeId);
                if (nodeNum !== 0) {
                    const node = coordinates[nodeNum];
                    const isServed = servedCustomers.has(nodeNum);

                    ctx.fillStyle = isServed ? '#27ae60' : '#3498db';
                    ctx.strokeStyle = isServed ? '#1e8449' : '#2e86ab';
                    ctx.lineWidth = 2;

                    ctx.beginPath();
                    ctx.arc(node.x, node.y, 8, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();

                    if (isServed) {
                        ctx.fillStyle = 'white';
                        ctx.font = 'bold 10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('‚úì', node.x, node.y + 3);
                    } else {
                        ctx.fillStyle = 'white';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(nodeNum.toString(), node.x, node.y + 3);
                    }
                }
            });
        }

        function drawVehicle(vehicle) {
            const pos = vehicle.position;
            const size = 16;

            ctx.fillStyle = vehicle.color;
            ctx.strokeStyle = vehicle.isMoving ? '#2c3e50' : '#7f8c8d';
            ctx.lineWidth = 2;

            if (vehicle.isMoving) {
                // Add pulsing effect for moving vehicles
                const pulseSize = size + Math.sin(Date.now() * 0.01) * 2;
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, pulseSize / 2, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
            } else {
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, size / 2, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
            }

            // Draw vehicle ID
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(vehicle.id.toString(), pos.x, pos.y + 4);

            // Draw vehicle number above
            ctx.fillStyle = vehicle.color;
            ctx.font = 'bold 10px Arial';
            ctx.fillText(`V${vehicle.id}`, pos.x, pos.y - size);
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>

</html>